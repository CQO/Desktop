{"version":3,"file":"certificate.js","sources":["app/certificate.js"],"sourcesContent":["import { app, dialog } from 'electron';\nimport path from 'path';\nimport fs from 'fs';\nimport url from 'url';\n\nclass CertificateStore {\n\tconstructor() {\n\t\tthis.storeFile = path.resolve(app.getPath('userData'), 'certificate.json');\n\t\tthis.load();\n\t}\n\n\tinitWindow(win) {\n\t\tthis.window = win;\n\t\tapp.on('certificate-error', (event, webContents, url, error, certificate, callback) => {\n\t\t\tif (this.isTrusted(url, certificate)) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcallback(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar detail = `URL: ${url}\\nError: ${error}`;\n\t\t\tif (this.isExisting(url)) {\n\t\t\t\tdetail = `Certificate is different from previous one.\\n\\n` + detail;\n\t\t\t}\n\n\t\t\tdialog.showMessageBox(this.window, {\n\t\t\t\ttitle: 'Certificate error',\n\t\t\t\tmessage: `Do you trust certificate from \"${certificate.issuerName}\"?`,\n\t\t\t\tdetail: detail,\n\t\t\t\ttype: 'warning',\n\t\t\t\tbuttons: [\n\t\t\t\t\t'Yes',\n\t\t\t\t\t'No'\n\t\t\t\t],\n\t\t\t\tcancelId: 1\n\t\t\t}, (response) => {\n\t\t\t\tif (response === 0) {\n\t\t\t\t\tthis.add(url, certificate);\n\t\t\t\t\tthis.save();\n\t\t\t\t\tif (webContents.getURL().indexOf('file://') === 0) {\n\t\t\t\t\t\twebContents.send('certificate-reload', url);\n\t\t\t\t\t} else {\n\t\t\t\t\t\twebContents.loadURL(url);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tcallback(false);\n\t\t});\n\t}\n\n\tload() {\n\t\ttry {\n\t\t\tthis.data = JSON.parse(fs.readFileSync(this.storeFile, 'utf-8'));\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.log(e);\n\t\t\tthis.data = {};\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis.data = {};\n\t\tthis.save();\n\t}\n\n\tsave() {\n\t\tfs.writeFileSync(this.storeFile, JSON.stringify(this.data));\n\t}\n\n\tparseCertificate(certificate) {\n\t\treturn certificate.issuerName + '\\n' + certificate.data.toString();\n\t}\n\n\tgetHost(certUrl) {\n\t\treturn url.parse(certUrl).host;\n\t}\n\n\tadd(certUrl, certificate) {\n\t\tconst host = this.getHost(certUrl);\n\t\tthis.data[host] = this.parseCertificate(certificate);\n\t}\n\n\tisExisting(certUrl) {\n\t\tconst host = this.getHost(certUrl);\n\t\treturn this.data.hasOwnProperty(host);\n\t}\n\n\tisTrusted(certUrl, certificate) {\n\t\tvar host = this.getHost(certUrl);\n\t\tif (!this.isExisting(certUrl)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.data[host] === this.parseCertificate(certificate);\n\t}\n}\n\nconst certificateStore = new CertificateStore();\n\nexport default certificateStore;\n"],"names":["dialog","app"],"mappings":"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"}